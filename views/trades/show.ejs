<%- include('../partials/header.ejs') %>
<div class="trade-details-container">
  <div><h2>Trade Details</h2></div>
  <div class="trade-details-indicators-container">
    <div class="trade-details">
      <div class="trade-details-row"> <div>Position:</div>
      <div><%= trade.position %></div></div>
       <div class="trade-details-row"><div>Status:</div>
       <div><%= trade.stat %></div></div>
        <div class="trade-details-row"><div>Pair:</div>
        <div><%= trade.pair %></div></div>
        <div class="trade-details-row"><div>Open Date:</div>
        <div><%= trade.openDate.toLocaleDateString('en-GB', {timeZone: 'UTC'}) %></div></div>
        <div class="trade-details-row"><div>Open Price:</div>
        <div><%= trade.openPrice %></div></div>
        <div class="trade-details-row"> <div>Quantity:</div>
        <div><%= trade.quantity %></div></div>
       <div class="trade-details-row"> <div>Close Date:</div>
       <div> <% if (trade.closeDate) {%> <%= trade.closeDate.toLocaleDateString('en-GB',
         {timeZone: 'UTC'}) %> <% } else { %> - <% } %></div></div>
       <div class="trade-details-row">  <div>Close Price:</div>
        <div><% if (trade.closePrice) {%> <%= trade.closePrice %> <% } else { %> - <% }
          %></div></div>
      <div class="trade-details-row"> <div>Fees Paid:</div>
      <div><% if (trade.fees) {%> <%= trade.fees %> <% } else { %> - <% } %></div></div>
       
        <div class="trade-details-row"><div class="edit-edit-btn"><a href="/trades/<%= trade._id %>/edit">Edit</a></div></div>
      </div>

      <div class="indicators-container">
      <div class="indicators-header">Indicators used for trade:</div>
      <div class="indicator-list">
        <div class="indicators">
      <% if (trade.ind.length) { %>
      
        <%- trade.ind.map(i => `
        <div class="indicators-elements">
        <div>${i.name}</div>
       <div ><form class="delete-indicator"
        action="/trades/${trade._id}/indicators/${i._id}?_method=delete"
        method="POST"
      > <button class = "delete-indicator-btn"><span>X</span></button></form></div></div>
      `).join('') %>
      <% } else { %>
        No Indicators
        <% } %>
      </div>


<div></div>
      <form
  action="/trades/<%= trade._id %>/indicators"
  method="POST"
>
  <select name="indicatorId">
    <%- indicators.map(i => `
    <option value="${i._id}">${i.name}</option>
    `).join('') %>
  </select>
  <button type="submit">Add Indicators</button>
</form></div></div></div>




<div class="comments-container">
<h2>Comments:</h2>
<% if (trade.comments.length) { %>
  <table>
    <thead>
      <tr>
        <th>Date created:</th>
        <th>Text:</th>
      </tr>
    </thead>
    <tbody>
        <% trade.comments.sort((a, b) => a.createdAt - b.createdAt) %>
      <% trade.comments.forEach(function(t) { %>
      <tr>
        <td><%= t.createdAt.toLocaleDateString('en-GB', {timeZone: 'UTC'}) %></td>
        <td><%= t.content %></d></td>
        <td> 
            <form
            action="/trades/<%= trade._id %>/comments/<%= t._id %>?_method=delete"
            method="POST"
          >
            <button>X</button>
          </form></td>
      </tr>
      <% }); %>
    </tbody>
  </table>
  <% } else { %>
  <h5>No Comments Yet</h5>
  <% } %>
  <br />
  <h2>Add Comment</h2>
<form
  method="POST"
  action="/trades/<%= trade._id %>/comments"
>
  <textarea name="content"></textarea>
  <input type="submit" value="Add Comment" />
</form></div>
</div>
<%- include('../partials/footer.ejs') %>